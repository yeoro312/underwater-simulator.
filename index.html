let people = [];
let day = 1;

const nameInput = document.getElementById("nameInput");
const targetSelect = document.getElementById("targetSelect");
const relationSelect = document.getElementById("relationSelect");
const list = document.getElementById("list");
const logBox = document.getElementById("log");

function log(text) {
  logBox.textContent += text + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}

// ë“œë¡­ë‹¤ìš´ ê°±ì‹ 
function updateTargetSelect() {
  targetSelect.innerHTML = `<option value="">ê´€ê³„ ëŒ€ìƒ ì—†ìŒ</option>`;
  people.forEach(p => {
    const opt = document.createElement("option");
    opt.value = p.name;
    opt.textContent = p.name;
    targetSelect.appendChild(opt);
  });
}

// ìºë¦­í„° ì¶”ê°€
document.getElementById("addBtn").onclick = () => {
  if (nameInput.value === "") return;

  const newPerson = {
    name: nameInput.value,
    state: "ğŸŒŠ ì•ˆì •",
    relations: {}
  };

  // ê¸°ì¡´ ìºë¦­í„°ë“¤ê³¼ ê¸°ë³¸ ì¤‘ë¦½ ê´€ê³„
  people.forEach(p => {
    p.relations[newPerson.name] = 0;
    newPerson.relations[p.name] = 0;
  });

  // ì´ˆê¸° ê´€ê³„ ì„¤ì •
  const targetName = targetSelect.value;
  const value = Number(relationSelect.value);

  if (targetName) {
    newPerson.relations[targetName] = value;
    const target = people.find(p => p.name === targetName);
    target.relations[newPerson.name] = value;

    log(`ğŸ«§ ${newPerson.name} â†” ${targetName} ê´€ê³„ ì„¤ì • (${value})`);
  }

  people.push(newPerson);
  nameInput.value = "";
  updateTargetSelect();
  draw();
};

// í•˜ë£¨ ì§„í–‰
document.getElementById("nextBtn").onclick = () => {
  if (people.length < 2) return;

  log(`\nğŸŒŠ ì¡°ë¥˜ ${day}íšŒì°¨`);

  const states = ["ğŸŒŠ ì•ˆì •", "ğŸ’¨ ê°•í•œ ë¬¼ì‚´", "ğŸŒ‘ ì‹¬í•´ íœ´ì‹"];
  people.forEach(p => {
    p.state = states[Math.floor(Math.random() * states.length)];
  });

  // ëœë¤ ìƒí˜¸ì‘ìš©
  const a = people[Math.floor(Math.random() * people.length)];
  let b;
  do {
    b = people[Math.floor(Math.random() * people.length)];
  } while (a === b);

  interact(a, b);
  day++;
  draw();
};

// ìƒí˜¸ì‘ìš©
function interact(a, b) {
  const change = Math.floor(Math.random() * 11) - 5;
  a.relations[b.name] += change;
  b.relations[a.name] += change;

  log(`ğŸ  ${a.name} â†” ${b.name} (${change > 0 ? "+" : ""}${change})`);

  if (a.relations[b.name] >= 30) {
    log(`ğŸ’™ ${a.name}ì™€ ${b.name}ëŠ” ì—°ì¸ ìƒíƒœë‹¤`);
  }
}

// í™”ë©´ ì¶œë ¥
function draw() {
  list.innerHTML = "";

  people.forEach(p => {
    const li = document.createElement("li");
    li.innerHTML = `
      <strong>ğŸ  ${p.name}</strong> (${p.state})<br>
      ${Object.entries(p.relations)
        .map(([name, value]) => {
          let icon = "ğŸ¤";
          if (value >= 30) icon = "ğŸ’™";
          else if (value >= 10) icon = "ğŸ’š";
          else if (value <= -10) icon = "ğŸ’¢";
          return `${icon} ${name}: ${value}`;
        })
        .join("<br>")}
    `;
    list.appendChild(li);
  });
}
